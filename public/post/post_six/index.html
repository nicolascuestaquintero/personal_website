<!DOCTYPE html>
<html lang='en'><head>
  <title>Binomial Trees and the Cox-Ross-Rubinstein Model - Nicolas Cuesta</title>
  <link rel='canonical' href='/post/post_six/' />
  <meta charset='utf-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1' />
  <meta name='description' content='' />
  <meta name='theme-color' content='#FFFFFF' />
  
    <link rel="shortcut icon" href="logo.png" type="image/x-icon" />
    <link rel="icon" href="logo.png" type="image/x-icon" />
  

  <meta name="generator" content="Hugo 0.73.0" />

  





<link rel="stylesheet" href="/sass/style.min.cf2eeff825d4dbc673ce0b82d270d9fc32d34973a7d5cd079e0dcf4fe3e77515.css" integrity="sha256-zy7v&#43;CXU28ZzzguC0nDZ/DLTSXOn1c0Hng3PT&#43;PndRU=" media="screen">
<link rel="stylesheet" href="/syntax.min.css" integrity="" media="screen">

  <meta property="og:title" content="Binomial Trees and the Cox-Ross-Rubinstein Model" />
<meta property="og:description" content="Pricing derivative securities has been one of the main financial problems forboth academics and practitioners. This is the price to pay for options representinginsurance claims, interest or exchange rate hedging swaps, forward prices of commodities oreven stock options for top managerial position salaries. Usually the binomial model forpricing derivatives at Undergraduate level is used to show how to price options by takingthe expected present value of future claims on risk-neutral probability spaces." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/post_six/" />
<meta property="article:published_time" content="2021-02-04T00:00:00-05:00" />
<meta property="article:modified_time" content="2021-02-04T00:00:00-05:00" />

  <meta itemprop="name" content="Binomial Trees and the Cox-Ross-Rubinstein Model">
<meta itemprop="description" content="Pricing derivative securities has been one of the main financial problems forboth academics and practitioners. This is the price to pay for options representinginsurance claims, interest or exchange rate hedging swaps, forward prices of commodities oreven stock options for top managerial position salaries. Usually the binomial model forpricing derivatives at Undergraduate level is used to show how to price options by takingthe expected present value of future claims on risk-neutral probability spaces.">
<meta itemprop="datePublished" content="2021-02-04T00:00:00-05:00" />
<meta itemprop="dateModified" content="2021-02-04T00:00:00-05:00" />
<meta itemprop="wordCount" content="1014">



<meta itemprop="keywords" content="Options pricing,trading,quantfinance," />
</head>
<body>

  <header style="background-image:linear-gradient(
      rgba(0,0,0,0.4),rgba(0,0,0,0.4)
    ),url(&#39;/images/sidebar.jpg&#39;)">

  <div class="intro">
    <div class="logo-container">
      <a href="/">
        <img src='/images/nicolas.jpg' alt="Profile HOME" class="rounded-logo">
      </a>
    </div>
    <h2>Nicolas Cuesta</h2>
    <h3>Financial Engineer</h3>
    <div class="menu">
      

        <p>
            <a href="/resume/">
                Resume
            </a>
        </p>

        <p>
            <a href="/tools/">
                Tools
            </a>
        </p>

        <p>
            <a href="/post/">
                Blog
            </a>
        </p>

      
        
        <p>
            <a href="mailto:nicolaicuesta@hotmail.com" target="_blank" rel="external">
                Contact me
            </a>
        </p>
      
    </div>

  </div>

  <div class="socials">
      
  
    <a href="https://github.com/nicolascuestaquintero/" class="social-link" target="_blank" rel="noopener" ><div class="icon">
  <svg width="35px" height="35px" viewBox="0 0 115 115" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img">
  
  <path d="M102.679 0H12.32C5.52 0 0 5.519 0 12.321v90.358C0 109.48 5.519 115 12.321 115h90.358c6.802 0 12.321-5.519 12.321-12.321V12.32C115 5.52 109.481 0 102.679 0zM71.182 98.494c-2.156.385-2.952-.95-2.952-2.053 0-1.386.051-8.471.051-14.195 0-4.005-1.335-6.546-2.9-7.881C74.878 73.313 84.89 72.003 84.89 55.6c0-4.671-1.669-7.007-4.39-10.01.436-1.105 1.9-5.648-.436-11.552-3.568-1.104-11.731 4.595-11.731 4.595-3.389-.95-7.06-1.438-10.679-1.438-3.62 0-7.29.488-10.679 1.438 0 0-8.163-5.699-11.73-4.595-2.337 5.878-.899 10.422-.437 11.551-2.72 3.004-4.004 5.34-4.004 10.011 0 16.326 9.574 17.712 19.072 18.765-1.232 1.104-2.336 3.003-2.72 5.724-2.44 1.104-8.677 3.004-12.4-3.568-2.335-4.056-6.545-4.39-6.545-4.39-4.159-.05-.282 2.619-.282 2.619 2.772 1.283 4.723 6.212 4.723 6.212 2.49 7.624 14.4 5.057 14.4 5.057 0 3.568.052 9.37.052 10.422 0 1.104-.77 2.438-2.952 2.053C27.21 92.821 15.35 76.701 15.35 57.86c0-23.564 18.02-41.456 41.585-41.456s42.663 17.892 42.663 41.456c.026 18.842-11.474 34.988-28.416 40.635zM46 82.81c-.488.103-.95-.102-1.001-.436-.051-.385.282-.719.77-.822.488-.05.95.154 1.001.488.077.334-.257.668-.77.77zm-2.439-.23c0 .333-.385.615-.898.615-.565.052-.95-.23-.95-.616 0-.333.385-.616.899-.616.487-.051.95.231.95.616zm-3.516-.283c-.103.334-.616.488-1.053.334-.488-.103-.821-.488-.719-.822.103-.334.617-.488 1.053-.385.513.154.847.54.719.873zm-3.158-1.386c-.23.282-.718.23-1.104-.154-.385-.334-.487-.822-.23-1.053.23-.282.718-.23 1.103.154.334.334.462.847.231 1.053zm-2.336-2.336c-.23.154-.667 0-.95-.385-.282-.385-.282-.822 0-1.001.283-.231.72-.052.95.333.283.385.283.847 0 1.053zm-1.668-2.49c-.231.23-.616.103-.899-.154-.282-.334-.333-.719-.102-.899.23-.23.616-.102.898.154.282.334.334.72.103.899zm-1.72-1.9c-.103.231-.436.283-.719.103-.334-.154-.488-.436-.385-.667.103-.154.385-.231.719-.103.334.18.488.462.385.667z"/>
  
  </svg>
</div>
</a>
  

  
    <a href="https://www.linkedin.com/in/nicol%C3%A1s-cuesta-quintero-341ba9108/" class="social-link" target="_blank" rel="noopener" ><div class="icon">
  <svg width="35px" height="35px" viewBox="0 0 115 115" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img">
  
  <path d="M106.786 0H8.189C3.67 0 0 3.722 0 8.291v98.418C0 111.278 3.67 115 8.189 115h98.597c4.518 0 8.214-3.722 8.214-8.291V8.29C115 3.722 111.304 0 106.786 0zm-72.03 98.571H17.713V43.69h17.07V98.57h-.025zm-8.522-62.377c-5.467 0-9.882-4.44-9.882-9.883 0-5.442 4.415-9.882 9.882-9.882 5.442 0 9.883 4.44 9.883 9.882a9.87 9.87 0 0 1-9.883 9.883zm72.414 62.377H81.604V71.875c0-6.366-.129-14.555-8.856-14.555-8.882 0-10.242 6.931-10.242 14.093V98.57H45.46V43.69h16.352v7.495h.23c2.285-4.312 7.855-8.856 16.147-8.856 17.25 0 20.458 11.372 20.458 26.158V98.57z"/>
  
  </svg>
</div>
</a>
  

  
    <a href="https://twitter.com/nicolascuestaq/" class="social-link" target="_blank" rel="noopener" ><div class="icon">
  <svg width="35px" height="35px" viewBox="0 0 115 115" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img">
  
  <path d="M102.679 0H12.32C5.52 0 0 5.519 0 12.321v90.358C0 109.48 5.519 115 12.321 115h90.358c6.802 0 12.321-5.519 12.321-12.321V12.32C115 5.52 109.481 0 102.679 0zM90.126 40.763c.051.72.051 1.464.051 2.182 0 22.256-16.942 47.9-47.9 47.9-9.548 0-18.404-2.772-25.848-7.547 1.36.154 2.67.205 4.055.205 7.881 0 15.12-2.67 20.895-7.187-7.392-.154-13.604-5.006-15.735-11.68 2.593.385 4.929.385 7.598-.308a16.837 16.837 0 0 1-13.476-16.531v-.205a16.824 16.824 0 0 0 7.598 2.13 16.8 16.8 0 0 1-7.496-14.016c0-3.131.822-6.006 2.285-8.496a47.803 47.803 0 0 0 34.705 17.61c-2.387-11.424 6.161-20.69 16.429-20.69 4.851 0 9.215 2.027 12.296 5.313a32.99 32.99 0 0 0 10.678-4.056 16.792 16.792 0 0 1-7.393 9.267c3.389-.36 6.674-1.31 9.703-2.618a35.437 35.437 0 0 1-8.445 8.727z"/>
  
  </svg>
</div>
</a>
  

  </div>

</header>

  <div class="content-wrapper">
    
      <div class="breadcrumb">
  





<span >
  <a href="/">HOME</a>
   / 
</span>


<span >
  <a href="/post/">POST</a>
   / 
</span>


<span  class="active">
  <a href="/post/post_six/">Binomial Trees and the Cox-Ross-Rubinstein Model</a>
  
</span>

</div>

    
    <main id="content" class="post">

<h1>Binomial Trees and the Cox-Ross-Rubinstein Model</h1>
<div class="reading-time">
  <div class="icon">
  <svg width="18px" height="18px" viewBox="0 0 115 115" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img">
  
  <path d="M57.5 11C29.05 11 6 34.05 6 62.5S29.05 114 57.5 114 109 90.95 109 62.5 85.95 11 57.5 11zm0 93.032c-22.947 0-41.532-18.585-41.532-41.532 0-22.947 18.585-41.532 41.532-41.532 22.947 0 41.532 18.585 41.532 41.532 0 22.947-18.585 41.532-41.532 41.532zm12.833-21.68L52.703 69.54a2.508 2.508 0 0 1-1.018-2.015V33.427a2.5 2.5 0 0 1 2.492-2.492h6.646a2.5 2.5 0 0 1 2.492 2.492v29.426l13.871 10.092c1.122.81 1.35 2.368.54 3.49l-3.904 5.377a2.51 2.51 0 0 1-3.489.54z"/>
  
  </svg>
</div>

  <span>5 minutes</span>
</div>

<div class="published-date">
  <div class="icon">
  <svg width="18px" height="18px" viewBox="0 0 115 115" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img">
  
  <path d="M77.577 51.23a1.807 1.807 0 0 0-2.2.342l-27.562 27.79a1.807 1.807 0 0 1-2.2.342l-14.008-9.702a1.807 1.807 0 0 0-2.2.342l-1.952 1.968c-.287.22-.456.568-.455.936.001.37.172.716.46.934L45.637 86.77a1.807 1.807 0 0 0 2.2-.342l31.709-31.97c.287-.22.456-.567.455-.936a1.175 1.175 0 0 0-.46-.933l-1.963-1.36z"/><path d="M97.304 20H80.512c-.041.34-.063.683-.064 1.026a5.986 5.986 0 0 0 1.256 4.1c.054.003.103.02.157.025a4.881 4.881 0 0 1 1.865-.025c3.05.562 4.984 3.907 4.32 7.47-.666 3.563-3.678 5.996-6.728 5.433a4.932 4.932 0 0 1-2.437-1.258c-6.018-1.378-10.445-7.795-10.445-15.745 0-.347.023-.685.04-1.026H34.579c-.041.34-.063.683-.064 1.026a5.986 5.986 0 0 0 1.256 4.1c.054.003.103.02.157.025a4.881 4.881 0 0 1 1.865-.025c3.05.562 4.984 3.907 4.32 7.47-.666 3.563-3.678 5.996-6.728 5.433a4.932 4.932 0 0 1-2.437-1.258c-6.018-1.378-10.445-7.795-10.445-15.745 0-.22.019-.434.025-.652a9.788 9.788 0 0 0-5.697 4.471 9.683 9.683 0 0 0-2.65 4.764L1.158 92.871c-.965 4.689 2.6 8.503 7.948 8.503h6.334v2.673c-.077 5.41 4.263 9.861 9.705 9.953h72.16c5.438-.095 9.774-4.546 9.694-9.953V29.953c.08-5.407-4.256-9.858-9.695-9.953zM10.078 96.653c-2.378 0-3.964-1.697-3.535-3.782L16.637 43.84h80.787L87.331 92.871a5.254 5.254 0 0 1-5.091 3.782H10.078zm91.535 7.394c.036 2.403-1.891 4.382-4.308 4.424h-72.16c-2.42-.04-4.352-2.018-4.32-4.424v-2.673h60.443c5.348 0 10.484-3.814 11.449-8.503l8.897-43.215v54.391z"/><path d="M34.814 33c1.243 0 2.251-1.057 2.251-2.36 0-1.305-1.008-2.362-2.25-2.362-2.04 0-4.313-3.194-4.313-7.778s2.272-7.778 4.312-7.778c1.227 0 2.536 1.163 3.386 3.084H43C41.716 11.19 38.578 8 34.814 8 29.871 8 26 13.49 26 20.5c0 7.009 3.871 12.5 8.814 12.5z"/>
  
  </svg>
</div>

  <span>February 4, 2021</span>
</div>




<p>Pricing derivative securities has been one of the main financial problems for
both academics and practitioners. This is the price to pay for options representing
insurance claims, interest or exchange rate hedging swaps, forward prices of commodities or
even stock options for top managerial position salaries. Usually the binomial model for
pricing derivatives at Undergraduate level is used to show how to price options by taking
the expected present value of future claims on risk-neutral probability spaces. The aim of this
post is to show a generalized version that allows to use binomial models to price any
kind of derivative, the importance of the No Arbitrage Principle and its equivalence
to the risk-neutral probability measure (martingale), to conclude with the
Cox-Ross-Rubinstein model for European call options. You can expect to find a summary of
the main theory behind these concepts and functions to make this practical knowledge in R.</p>
<p>We will use the following libraries:</p>
<pre class="r"><code>library(tidyverse)</code></pre>
<p>Discrete models for derivatives pricing are mostly based on trees, that trace all possible paths for the underlying asset spot price, and determine the derivative value based on the projected possible outcome values for the spot at expiration. These trees have as many steps as the appraiser wants to consider. For instance, if trading happens every five seconds and the option expires at market close, the tree can have 5,760 steps. However, the number of branches is a more complex question because it can lead to a unspecified systems of linear equations. Having a binomial tree is enough to price an option with one underlying stock, but miss-specified if we deal with a basket option. If we have two underlying stocks and one option, we would need to use a trinomial tree. On this post I am going to focus on using binomial trees to price any kind of derivative using the non-arbitrage principle, considering the limitations of the model. Note, however, than compared to popular knowledge on binomial trees, I will extend the concept to allow for pricing exotic options on one underlying asset, extending from classic path-independent (European) call option to a path-dependent Asian options, among others.</p>
<div id="spot-prices-processes" class="section level2">
<h2>Spot prices processes</h2>
<p>To build the spot price tree we are going to start from its most recent price known, and assume two possible outcomes every single moment. Let me explain. Say we want to price our derivative using a three steps binomial tree for the following weekdays. Assuming today is Tuesday end of day, we have to analyze the spot price on Wednesday, Thursday and Friday. We assume that the spot price is a random variable <span class="math inline">\(S(n):\Omega\rightarrow(0,\infty)\)</span> in some probability space <span class="math inline">\((\Omega,\mathcal{F},P)\)</span>, where the price can go up or down by <span class="math inline">\(S(n-1)U\)</span> or <span class="math inline">\(S(n-1)D\)</span> respectively, every single moment of time. Thus, the sample space is given by</p>
<p><span class="math display">\[\Omega=\{u,d\}^{3}=\{uuu,uud,\dots,ddu,ddd\};\]</span></p>
<p>with some probability measure <span class="math inline">\(P:\Omega\rightarrow[0,1]\)</span> such that <span class="math inline">\(P(\{u\})=p\)</span> and <span class="math inline">\(P(\{d\})=1-p\)</span>. We also assume the existence of a risk-free asset <span class="math inline">\(A\)</span> that can be used to lend or borrow money at a constant interest rate <span class="math inline">\(R\)</span>. For instance, if we borrow <span class="math inline">\(A(0)\)</span> at moment 0, we owe <span class="math inline">\(A(n)=A(0)(1+R)^{n}\)</span> at moment <em>n</em> (see figure below).</p>
<center>
<img src="/post/images/post_six_spotTree.png" title="fig:" id="id" class="class" style="width:100.0%;height:100.0%" alt="Figure 1. Price path for the underlying asset." />
</center>
<p>Notice that by commutativity law, we could have drawn the tree as a recombining one, i.e. since</p>
<p><span class="math display">\[S^{ud}(2)=S(0)(1+U)(1+D)=S(0)(1+D)(1+U)=S^{du}(2),\]</span></p>
<p>we were able to avoid some repetition in the tree. However, when pricing path-dependent derivatives each individual cell will become important and has its own derivative value. Therefore, I leave the general case from the beginning so the reader can get familiar with it.</p>
<pre class="r"><code># Determine spot price given total number of steps n, 
# and number of upward movements u_n.
spot_price &lt;- function(s0, u, d, n, u_n = n) 
  s0 * (1 + u) ^ (u_n) * (1 + d) ^ (n - u_n)

# Risk-free asset value at moment n.
rf_price &lt;- function(a0, r, n) 
  a0 * (1 + r) ^ n</code></pre>
</div>
<div id="no-arbitrage-pricing" class="section level2">
<h2>No Arbitrage Pricing</h2>
<p>Consider a portfolio holding two assets: the risk-free asset and the derivative underlying asset. If we can allocate our money in these two assets in such a way that it replicates the derivative cash flows, then we will end up with the same asset (stream of cash flows) in two different markets, the spot market and the derivatives market. Moreover, we can create a portfolio that holds both the derivative and the replicating portfolio with opposite positions; however, for the latter we would need to change the allocation in each asset at each step, so we rather call this portfolio a strategy. Intuitively, an arbitrage surges when the price of the same asset is different in both markets so that we can make a free lunch buying in the cheap market and selling in the expensive one. Therefore, we define an arbitrage opportunity as follows:</p>
<p>An arbitrage is a strategy with value <span class="math inline">\(V\)</span> such that <span class="math inline">\(V(0)=0\)</span> and <span class="math inline">\(V(n)\geq0\)</span> with strict inequality for some <span class="math inline">\(n&gt;0\)</span>.</p>
</div>
<div id="the-martingale-property" class="section level2">
<h2>The Martingale Property</h2>
</div>
<div id="the-cox-ross-rubinstein-binomial-model" class="section level2">
<h2>The Cox-Ross-Rubinstein binomial model</h2>
<p>The brilliance of Cox, Ross and Rubinstein (CRR) model is that they were able to value path-independent derivatives using binomial trees with a very simple formula, without any need to worry about explicitly building two trees or applying the martingale property. If the option payoff can be written as <span class="math inline">\(h(S(n=N))\)</span>, where <span class="math inline">\(h:\mathbb{R}\mapsto\mathbb{R}\)</span> is a continuous function and <span class="math inline">\(N\)</span> is the total number of steps of the model (i.e. the derivative is path-independent), then its value is given by</p>
<p><span class="math display">\[V(0)=(1+R)^{-N}\times\sum_{k=0}^{N}{N\choose k}q^{k}(1-q)^{N-k}h\left(S(0)(1+U)^{k}(1+D)^{N-k}\right).\]</span></p>
<pre class="r"><code># CRR valuation
dvt_price &lt;- function(h, s, u, d, r, N) {
  q &lt;- (r - d) / (u - d)
  scenarios &lt;- choose(N, 0:N) * q ^ (0:N) * (1 - q) ^ (N:0) * sapply(
    s * (1 + u) ^ (0:N) * (1 + d) ^ (N:0), h)
  sum(scenarios) * (1 + r) ^ (-N)
}

# Example: European Call

# Option payoff - h(S)
dvt_call &lt;- function(s) max(s - 105, 0)

# Option value - V(0)
dvt_price(dvt_call, 100, 0.2, -0.1, 0.1, 3)</code></pre>
<pre><code>## [1] 23.30745</code></pre>
</div>
<div id="references" class="section level2">
<h2>References</h2>
<p>[1] Capiński, M., &amp; Kopp, E. (2012). <em>Discrete models of financial markets</em> (Vol. 1). Cambridge University Press.</p>
<p>[2] Hull C, John (2015). <em>Options, Futures and other Derivatives</em> (9th edition). Pearson Education.</p>
</div>


    </main>
  </div>
  <footer>
    <div class="footer-wrapper">
      <p>Made with <a href="https://github.com/rstudio/blogdown/" target="_blank" rel="external">RStudio Blogdown</a> &mdash; Powered by <a href="https://gohugo.io/" target="_blank" rel="external">Hugo</a> and the <a href="https://github.com/bjacquemet/personal-web" target='_blank' rel="external">Personal Web</a> theme. Nicolás Cuesta Quintero ©.</p>
    </div>
  </footer>
  <link href="https://fonts.googleapis.com/css?family=Montserrat:500,600|Raleway:400,400i,600" rel="stylesheet">
  
</body>
</html>




    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
    
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
            processEscapes: true,
            processEnvironments: true
        },
        // Center justify equations in code and markdown cells. Elsewhere
        // we use CSS to left justify single line equations in code cells.
        displayAlign: 'center',
        "HTML-CSS": {
            styles: {'.MathJax_Display': {"margin": 0}},
            linebreaks: { automatic: true }
        }
    });
    </script>
    
