---
title: "Custom visualizations in Power BI"
author: "Nicolas Cuesta Quintero"
date: 2020-02-22T18:00:00-05:00
categories: ["R"]
tags: ["Power BI", "R", "Plotly"]
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(collapse = TRUE)
```


Microsoft Power BI is the current leader in the Gartner Magic Quadrant for Business Intelligence, and one of its main features is its capability for reading both R and Python code. But here is the thing, usually R plots remain as static images and lack of interactivity. Say, you want to know a point in an R scatter plot what value represents exactly. In R, you can use plotly to add this characteristic to your graphs but using plotly with Power BI default R code compiler leads to an error. The aim of this post is to show you how to embed HTML files in Power BI using R, opening the doors for other libraries such as plotly, ggmap and gganimate, among others.

We will use the following libraries:

```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(plotly)
library(dslabs)
```

## R and Power BI default visuals

Consider US 2016 presidential election polls data from the *dlabs* package. What I want to do right now is to create a visualization that allows us to know which prediction was made by pollsters graded A+ for Hillary Clinton and Donald Trump throughout 2016. I will use raw data instead of adjusted data since I want to know how far did polls put Hillary ahead of Trump despite their clear error. For the sake of simplicity, I will consider only general US data not segregated per State.

```{r}
p <- polls_us_election_2016 %>% 
  filter(grade == "A+",
         state == "U.S.") %>% 
  select(Date = enddate, 
         Pollster = pollster,
         Clinton = rawpoll_clinton, 
         Trump = rawpoll_trump) %>% 
  gather(Trump, Clinton, 
         key = "Candidate", 
         value = "Poll") %>% 
  ggplot(mapping = aes(x = Date,
                       y = Poll,
                       colour = Candidate)) + 
  geom_line() + geom_point() +
  facet_wrap(~Pollster, 
             nrow = 3) +
  scale_x_date(date_labels = "%b-%y",
               date_breaks = "1 month") +
  labs(x = "", 
       y = "Poll (% of total survey)", 
       title = "Hillary vs. Trump (2016)") +
  theme(axis.text.x = element_text(angle = 75,
                                   hjust = 1),
        plot.title = element_text(hjust = 0.5),
        axis.title.y.left = element_text(vjust = 1))

p
```

This plot is really helpful and let us get a general picture of what happened: pollsters in fact put Hillary Clinton over Donald Trump for most of the electoral race. Moreover, this plot can be tailored and transformed in many ways that may be a pain in the ass on Power BI. However, it has a bigger problem: it lacks of interactivity. For instance, it is almost imposible to say at which day ABC News and the Washington Post started their polls, neither how much was Donald Trump behind Hillary.

Luckily, plotly solve this problem relatively easy:

```{r}
ggplotly(p)
```

Let's move now to Power BI and see what would have happened.

## Creating custom visualizations

### Setting up your computer

### Fixing bugs

### Go for it!
