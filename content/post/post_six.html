---
title: "Binomial Trees and the Cox-Ross-Rubinstein Model"
author: "Nicolas Cuesta Quintero"
date: 2021-02-04T00:00:00-05:00
categories: ["R"]
tags: ["Options pricing", "trading", "quantfinance"]
---



<p>Pricing derivative securities has been one of the main financial problems for
both academics and practitioners. This is the price to pay for options representing
insurance claims, interest or exchange rate hedging swaps, forward prices of commodities or
even stock options for top managerial position salaries. Usually the binomial model for
pricing derivatives at Undergraduate level is used to show how to price options by taking
the expected present value of future claims on risk-neutral probability spaces. The aim of this
post is to show a generalized version that allows to use binomial models to price any
kind of derivative, the importance of the No Arbitrage Principle and its equivalence
to the risk-neutral probability measure (martingale), to conclude with the
Cox-Ross-Rubinstein model for European call options. You can expect to find a summary of
the main theory behind these concepts and functions to make this practical knowledge in R.</p>
<p>We will use the following libraries:</p>
<pre class="r"><code>library(tidyverse)</code></pre>
<p>Discrete models for derivatives pricing are mostly based on trees, that trace all possible paths for the underlying asset spot price, and determine the derivative value based on the projected possible outcome values for the spot at expiration. These trees have as many steps as the appraiser wants to consider. For instance, if trading happens every five seconds and the option expires at market close, the tree can have 5,760 steps. However, the number of branches is a more complex question because it can lead to a unspecified systems of linear equations. Having a binomial tree is enough to price an option with one underlying stock, but miss-specified if we deal with a basket option. If we have two underlying stocks and one option, we would need to use a trinomial tree. On this post I am going to focus on using binomial trees to price any kind of derivative using the non-arbitrage principle, considering the limitations of the model. Note, however, than compared to popular knowledge on binomial trees, I will extend the concept to allow for pricing exotic options on one underlying asset, extending from classic path-independent (European) call option to a path-dependent Asian options, among others.</p>
<div id="spot-prices-processes" class="section level2">
<h2>Spot prices processes</h2>
<p>To build the spot price tree we are going to start from its most recent price known, and assume two possible outcomes every single moment. Let me explain. Say we want to price our derivative using a three steps binomial tree for the following weekdays. Assuming today is Tuesday end of day, we have to analyze the spot price on Wednesday, Thursday and Friday. We assume that the spot price is a random variable <span class="math inline">\(S(n):\Omega\rightarrow(0,\infty)\)</span> in some probability space <span class="math inline">\((\Omega,\mathcal{F},P)\)</span>, where the price can go up or down by <span class="math inline">\(S(n-1)U\)</span> or <span class="math inline">\(S(n-1)D\)</span> respectively, every single moment of time. Thus, the sample space is given by</p>
<p><span class="math display">\[\Omega=\{u,d\}^{3}=\{uuu,uud,\dots,ddu,ddd\};\]</span></p>
<p>with some probability measure <span class="math inline">\(P:\Omega\rightarrow[0,1]\)</span> such that <span class="math inline">\(P(\{u\})=p\)</span> and <span class="math inline">\(P(\{d\})=1-p\)</span>. We also assume the existence of a risk-free asset <span class="math inline">\(A\)</span> that can be used to lend or borrow money at a constant interest rate <span class="math inline">\(R\)</span>. For instance, if we borrow <span class="math inline">\(A(0)\)</span> at moment 0, we owe <span class="math inline">\(A(n)=A(0)(1+R)^{n}\)</span> at moment <em>n</em> (see figure below).</p>
<center>
<img src="/post/images/post_six_spotTree.png" title="fig:" id="id" class="class" style="width:100.0%;height:100.0%" alt="Figure 1. Price path for the underlying asset." />
</center>
<p>Notice that by commutativity law, we could have drawn the tree as a recombining one, i.e. since</p>
<p><span class="math display">\[S^{ud}(2)=S(0)(1+U)(1+D)=S(0)(1+D)(1+U)=S^{du}(2),\]</span></p>
<p>we were able to avoid some repetition in the tree. However, when pricing path-dependent derivatives each individual cell will become important and has its own derivative value. Therefore, I leave the general case from the beginning so the reader can get familiar with it.</p>
<pre class="r"><code># Determine spot price given total number of steps n, 
# and number of upward movements u_n.
spot_price &lt;- function(s0, u, d, n, u_n = n) 
  s0 * (1 + u) ^ (u_n) * (1 + d) ^ (n - u_n)

# Risk-free asset value at moment n.
rf_price &lt;- function(a0, r, n) 
  a0 * (1 + r) ^ n</code></pre>
</div>
<div id="no-arbitrage-pricing" class="section level2">
<h2>No Arbitrage Pricing</h2>
<p>Consider a portfolio holding two assets: the risk-free asset and the derivative underlying asset. If we can allocate our money in these two assets in such a way that it replicates the derivative cash flows, then we will end up with the same asset (stream of cash flows) in two different markets, the spot market and the derivatives market. Moreover, we can create a portfolio that holds both the derivative and the replicating portfolio with opposite positions; however, for the latter we would need to change the allocation in each asset at each step, so we rather call this portfolio a strategy. Intuitively, an arbitrage surges when the price of the same asset is different in both markets so that we can make a free lunch buying in the cheap market and selling in the expensive one. Therefore, we define an arbitrage opportunity as follows:</p>
<p>An arbitrage is a strategy with value <span class="math inline">\(V\)</span> such that <span class="math inline">\(V(0)=0\)</span> and <span class="math inline">\(V(n)\geq0\)</span> with strict inequality for some <span class="math inline">\(n&gt;0\)</span>.</p>
</div>
<div id="the-martingale-property" class="section level2">
<h2>The Martingale Property</h2>
</div>
<div id="the-cox-ross-rubinstein-binomial-model" class="section level2">
<h2>The Cox-Ross-Rubinstein binomial model</h2>
<p>The brilliance of Cox, Ross and Rubinstein (CRR) model is that they were able to value path-independent derivatives using binomial trees with a very simple formula, without any need to worry about explicitly building two trees or applying the martingale property. If the option payoff can be written as <span class="math inline">\(h(S(n=N))\)</span>, where <span class="math inline">\(h:\mathbb{R}\mapsto\mathbb{R}\)</span> is a continuous function and <span class="math inline">\(N\)</span> is the total number of steps of the model (i.e. the derivative is path-independent), then its value is given by</p>
<p><span class="math display">\[V(0)=(1+R)^{-N}\times\sum_{k=0}^{N}{N\choose k}q^{k}(1-q)^{N-k}h\left(S(0)(1+U)^{k}(1+D)^{N-k}\right).\]</span></p>
<pre class="r"><code># CRR valuation
dvt_price &lt;- function(h, s, u, d, r, N) {
  q &lt;- (r - d) / (u - d)
  scenarios &lt;- choose(N, 0:N) * q ^ (0:N) * (1 - q) ^ (N:0) * sapply(
    s * (1 + u) ^ (0:N) * (1 + d) ^ (N:0), h)
  sum(scenarios) * (1 + r) ^ (-N)
}

# Example: European Call

# Option payoff - h(S)
dvt_call &lt;- function(s) max(s - 105, 0)

# Option value - V(0)
dvt_price(dvt_call, 100, 0.2, -0.1, 0.1, 3)</code></pre>
<pre><code>## [1] 23.30745</code></pre>
</div>
<div id="references" class="section level2">
<h2>References</h2>
<p>[1] Capiński, M., &amp; Kopp, E. (2012). <em>Discrete models of financial markets</em> (Vol. 1). Cambridge University Press.</p>
<p>[2] Hull C, John (2015). <em>Options, Futures and other Derivatives</em> (9th edition). Pearson Education.</p>
</div>
