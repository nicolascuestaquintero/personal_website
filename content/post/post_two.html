---
title: "Custom visualizations in Power BI"
author: "Nicolas Cuesta Quintero"
date: 2020-02-23T19:00:00-05:00
categories: ["R"]
tags: ["Power BI", "R", "Plotly"]
---

<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/plotly-binding/plotly.js"></script>
<script src="/rmarkdown-libs/typedarray/typedarray.min.js"></script>
<script src="/rmarkdown-libs/jquery/jquery.min.js"></script>
<link href="/rmarkdown-libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
<script src="/rmarkdown-libs/crosstalk/js/crosstalk.min.js"></script>
<link href="/rmarkdown-libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="/rmarkdown-libs/plotly-main/plotly-latest.min.js"></script>


<p>Microsoft Power BI is the current leader in the Gartner Magic Quadrant for Business Intelligence, and one of its main features is its capability for reading both R and Python code. But here is the thing, usually R plots remain as static images and lack of interactivity. Say, you want to know a point in an R scatter plot what value represents exactly. In R, you can use plotly to add this characteristic to your graphs but using plotly with Power BI default R code compiler leads to an error. The aim of this post is to show you how to embed HTML files in Power BI using R, opening the doors for other libraries such as plotly, ggmap and gganimate, among others.</p>
<p>We will use the following libraries:</p>
<pre class="r"><code>library(tidyverse)
library(plotly)
library(dslabs)</code></pre>
<div id="r-and-power-bi-default-visuals" class="section level2">
<h2>R and Power BI default visuals</h2>
<p>Consider US 2016 presidential election polls data from the <em>dlabs</em> package. What I want to do right now is to create a visualization that allows us to know which prediction was made by pollsters graded A+ for Hillary Clinton and Donald Trump throughout 2016. I will use raw data instead of adjusted data since I want to know how far did polls put Hillary ahead of Trump despite their clear error. For the sake of simplicity, I will consider only general US data not segregated per State.</p>
<pre class="r"><code>p &lt;- polls_us_election_2016 %&gt;% 
  filter(grade == &quot;A+&quot;,
         state == &quot;U.S.&quot;) %&gt;% 
  select(Date = enddate, 
         Pollster = pollster,
         Clinton = rawpoll_clinton, 
         Trump = rawpoll_trump) %&gt;% 
  gather(Trump, Clinton, 
         key = &quot;Candidate&quot;, 
         value = &quot;Poll&quot;) %&gt;%
  ggplot(mapping = aes(x = Date,
                       y = Poll,
                       colour = Candidate)) + 
  geom_line() + geom_point() +
  facet_wrap(~Pollster, 
             nrow = 3) +
  scale_x_date(date_labels = &quot;%b-%y&quot;,
               date_breaks = &quot;1 month&quot;) +
  scale_y_continuous(limits = c(30, 60)) +
  labs(x = &quot;&quot;, 
       y = &quot;Poll (% of total survey)&quot;, 
       title = &quot;Hillary vs. Trump (2016)&quot;) +
  theme(axis.text.x = element_text(angle = 75,
                                   hjust = 1),
        plot.title = element_text(hjust = 0.5),
        axis.title.y.left = element_text(vjust = 1))

p</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-2"></span>
<img src="/post/post_two_files/figure-html/unnamed-chunk-2-1.png" alt="US 2016 election race polls." width="672" />
<p class="caption">
Figure 1: US 2016 election race polls.
</p>
</div>
<p>This plot is really helpful and let us get a general picture of what happened: pollsters in fact put Hillary Clinton over Donald Trump for most of the electoral race. Moreover, this plot can be tailored and transformed in many ways that would be really hard on Power BI/DAX. However, it has a bigger problem: it lacks of interactivity. For instance, it is almost imposible to say at which day ABC News and the Washington Post started their polls, neither how much was Donald Trump behind Hillary.</p>
<p>Luckily, plotly solve this problem relatively easy:</p>
<pre class="r"><code>ggplotly(p, width = 500, height = 500)</code></pre>
<div id="htmlwidget-1" style="width:500px;height:500px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"data":[{"x":[16782,16866,16940,16975,16996,17017,17052,17066,17087,17097,17098,17099,17100,17101,17102,17103,17104,17105,17106,17107,17108,17109,17110,17111],"y":[50,50,44,48,45,48,46,46,47,50,49,48,48,47,46,46,45,46,47,47,47,48,47,47],"text":["Date: 2015-12-13<br />Poll: 50<br />Candidate: Clinton","Date: 2016-03-06<br />Poll: 50<br />Candidate: Clinton","Date: 2016-05-19<br />Poll: 44<br />Candidate: Clinton","Date: 2016-06-23<br />Poll: 48<br />Candidate: Clinton","Date: 2016-07-14<br />Poll: 45<br />Candidate: Clinton","Date: 2016-08-04<br />Poll: 48<br />Candidate: Clinton","Date: 2016-09-08<br />Poll: 46<br />Candidate: Clinton","Date: 2016-09-22<br />Poll: 46<br />Candidate: Clinton","Date: 2016-10-13<br />Poll: 47<br />Candidate: Clinton","Date: 2016-10-23<br />Poll: 50<br />Candidate: Clinton","Date: 2016-10-24<br />Poll: 49<br />Candidate: Clinton","Date: 2016-10-25<br />Poll: 48<br />Candidate: Clinton","Date: 2016-10-26<br />Poll: 48<br />Candidate: Clinton","Date: 2016-10-27<br />Poll: 47<br />Candidate: Clinton","Date: 2016-10-28<br />Poll: 46<br />Candidate: Clinton","Date: 2016-10-29<br />Poll: 46<br />Candidate: Clinton","Date: 2016-10-30<br />Poll: 45<br />Candidate: Clinton","Date: 2016-10-31<br />Poll: 46<br />Candidate: Clinton","Date: 2016-11-01<br />Poll: 47<br />Candidate: Clinton","Date: 2016-11-02<br />Poll: 47<br />Candidate: Clinton","Date: 2016-11-03<br />Poll: 47<br />Candidate: Clinton","Date: 2016-11-04<br />Poll: 48<br />Candidate: Clinton","Date: 2016-11-05<br />Poll: 47<br />Candidate: Clinton","Date: 2016-11-06<br />Poll: 47<br />Candidate: Clinton"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(248,118,109,1)","dash":"solid"},"hoveron":"points","name":"Clinton","legendgroup":"Clinton","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[16880,16971,16998,17020,17041,17069,17090,17111],"y":[42,44,45,50,46,46,50,50],"text":["Date: 2016-03-20<br />Poll: 42<br />Candidate: Clinton","Date: 2016-06-19<br />Poll: 44<br />Candidate: Clinton","Date: 2016-07-16<br />Poll: 45<br />Candidate: Clinton","Date: 2016-08-07<br />Poll: 50<br />Candidate: Clinton","Date: 2016-08-28<br />Poll: 46<br />Candidate: Clinton","Date: 2016-09-25<br />Poll: 46<br />Candidate: Clinton","Date: 2016-10-16<br />Poll: 50<br />Candidate: Clinton","Date: 2016-11-06<br />Poll: 50<br />Candidate: Clinton"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(248,118,109,1)","dash":"solid"},"hoveron":"points","name":"Clinton","legendgroup":"Clinton","showlegend":false,"xaxis":"x","yaxis":"y2","hoverinfo":"text","frame":null},{"x":[16882,16965,17021,17068,17091,17111],"y":[54,49,44,41,47,44],"text":["Date: 2016-03-22<br />Poll: 54<br />Candidate: Clinton","Date: 2016-06-13<br />Poll: 49<br />Candidate: Clinton","Date: 2016-08-08<br />Poll: 44<br />Candidate: Clinton","Date: 2016-09-24<br />Poll: 41<br />Candidate: Clinton","Date: 2016-10-17<br />Poll: 47<br />Candidate: Clinton","Date: 2016-11-06<br />Poll: 44<br />Candidate: Clinton"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(248,118,109,1)","dash":"solid"},"hoveron":"points","name":"Clinton","legendgroup":"Clinton","showlegend":false,"xaxis":"x","yaxis":"y3","hoverinfo":"text","frame":null},{"x":[16782,16866,16940,16975,16996,17017,17052,17066,17087,17097,17098,17099,17100,17101,17102,17103,17104,17105,17106,17107,17108,17109,17110,17111],"y":[44,41,46,39,39,40,41,44,43,38,40,42,44,45,45,45,46,46,45,44,43,43,43,43],"text":["Date: 2015-12-13<br />Poll: 44<br />Candidate: Trump","Date: 2016-03-06<br />Poll: 41<br />Candidate: Trump","Date: 2016-05-19<br />Poll: 46<br />Candidate: Trump","Date: 2016-06-23<br />Poll: 39<br />Candidate: Trump","Date: 2016-07-14<br />Poll: 39<br />Candidate: Trump","Date: 2016-08-04<br />Poll: 40<br />Candidate: Trump","Date: 2016-09-08<br />Poll: 41<br />Candidate: Trump","Date: 2016-09-22<br />Poll: 44<br />Candidate: Trump","Date: 2016-10-13<br />Poll: 43<br />Candidate: Trump","Date: 2016-10-23<br />Poll: 38<br />Candidate: Trump","Date: 2016-10-24<br />Poll: 40<br />Candidate: Trump","Date: 2016-10-25<br />Poll: 42<br />Candidate: Trump","Date: 2016-10-26<br />Poll: 44<br />Candidate: Trump","Date: 2016-10-27<br />Poll: 45<br />Candidate: Trump","Date: 2016-10-28<br />Poll: 45<br />Candidate: Trump","Date: 2016-10-29<br />Poll: 45<br />Candidate: Trump","Date: 2016-10-30<br />Poll: 46<br />Candidate: Trump","Date: 2016-10-31<br />Poll: 46<br />Candidate: Trump","Date: 2016-11-01<br />Poll: 45<br />Candidate: Trump","Date: 2016-11-02<br />Poll: 44<br />Candidate: Trump","Date: 2016-11-03<br />Poll: 43<br />Candidate: Trump","Date: 2016-11-04<br />Poll: 43<br />Candidate: Trump","Date: 2016-11-05<br />Poll: 43<br />Candidate: Trump","Date: 2016-11-06<br />Poll: 43<br />Candidate: Trump"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(0,191,196,1)","dash":"solid"},"hoveron":"points","name":"Trump","legendgroup":"Trump","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[16880,16971,16998,17020,17041,17069,17090,17111],"y":[34,37,43,37,39,42,38,44],"text":["Date: 2016-03-20<br />Poll: 34<br />Candidate: Trump","Date: 2016-06-19<br />Poll: 37<br />Candidate: Trump","Date: 2016-07-16<br />Poll: 43<br />Candidate: Trump","Date: 2016-08-07<br />Poll: 37<br />Candidate: Trump","Date: 2016-08-28<br />Poll: 39<br />Candidate: Trump","Date: 2016-09-25<br />Poll: 42<br />Candidate: Trump","Date: 2016-10-16<br />Poll: 38<br />Candidate: Trump","Date: 2016-11-06<br />Poll: 44<br />Candidate: Trump"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(0,191,196,1)","dash":"solid"},"hoveron":"points","name":"Trump","legendgroup":"Trump","showlegend":false,"xaxis":"x","yaxis":"y2","hoverinfo":"text","frame":null},{"x":[16882,16965,17021,17068,17091,17111],"y":[36,37,40,43,38,41],"text":["Date: 2016-03-22<br />Poll: 36<br />Candidate: Trump","Date: 2016-06-13<br />Poll: 37<br />Candidate: Trump","Date: 2016-08-08<br />Poll: 40<br />Candidate: Trump","Date: 2016-09-24<br />Poll: 43<br />Candidate: Trump","Date: 2016-10-17<br />Poll: 38<br />Candidate: Trump","Date: 2016-11-06<br />Poll: 41<br />Candidate: Trump"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(0,191,196,1)","dash":"solid"},"hoveron":"points","name":"Trump","legendgroup":"Trump","showlegend":false,"xaxis":"x","yaxis":"y3","hoverinfo":"text","frame":null},{"x":[17111,17110,17109,17108,17107,17106,17105,17104,17103,17102,17087,17101,17100,17099,17098,17097,17066,17052,17017,16996,16975,16940,16866,16782],"y":[47,47,48,47,47,47,46,45,46,46,47,47,48,48,49,50,46,46,48,45,48,44,50,50],"text":["Date: 2016-11-06<br />Poll: 47<br />Candidate: Clinton","Date: 2016-11-05<br />Poll: 47<br />Candidate: Clinton","Date: 2016-11-04<br />Poll: 48<br />Candidate: Clinton","Date: 2016-11-03<br />Poll: 47<br />Candidate: Clinton","Date: 2016-11-02<br />Poll: 47<br />Candidate: Clinton","Date: 2016-11-01<br />Poll: 47<br />Candidate: Clinton","Date: 2016-10-31<br />Poll: 46<br />Candidate: Clinton","Date: 2016-10-30<br />Poll: 45<br />Candidate: Clinton","Date: 2016-10-29<br />Poll: 46<br />Candidate: Clinton","Date: 2016-10-28<br />Poll: 46<br />Candidate: Clinton","Date: 2016-10-13<br />Poll: 47<br />Candidate: Clinton","Date: 2016-10-27<br />Poll: 47<br />Candidate: Clinton","Date: 2016-10-26<br />Poll: 48<br />Candidate: Clinton","Date: 2016-10-25<br />Poll: 48<br />Candidate: Clinton","Date: 2016-10-24<br />Poll: 49<br />Candidate: Clinton","Date: 2016-10-23<br />Poll: 50<br />Candidate: Clinton","Date: 2016-09-22<br />Poll: 46<br />Candidate: Clinton","Date: 2016-09-08<br />Poll: 46<br />Candidate: Clinton","Date: 2016-08-04<br />Poll: 48<br />Candidate: Clinton","Date: 2016-07-14<br />Poll: 45<br />Candidate: Clinton","Date: 2016-06-23<br />Poll: 48<br />Candidate: Clinton","Date: 2016-05-19<br />Poll: 44<br />Candidate: Clinton","Date: 2016-03-06<br />Poll: 50<br />Candidate: Clinton","Date: 2015-12-13<br />Poll: 50<br />Candidate: Clinton"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":1,"size":5.66929133858268,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(248,118,109,1)"}},"hoveron":"points","name":"Clinton","legendgroup":"Clinton","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[17111,17090,17069,17041,17020,16998,16971,16880],"y":[50,50,46,46,50,45,44,42],"text":["Date: 2016-11-06<br />Poll: 50<br />Candidate: Clinton","Date: 2016-10-16<br />Poll: 50<br />Candidate: Clinton","Date: 2016-09-25<br />Poll: 46<br />Candidate: Clinton","Date: 2016-08-28<br />Poll: 46<br />Candidate: Clinton","Date: 2016-08-07<br />Poll: 50<br />Candidate: Clinton","Date: 2016-07-16<br />Poll: 45<br />Candidate: Clinton","Date: 2016-06-19<br />Poll: 44<br />Candidate: Clinton","Date: 2016-03-20<br />Poll: 42<br />Candidate: Clinton"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":1,"size":5.66929133858268,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(248,118,109,1)"}},"hoveron":"points","name":"Clinton","legendgroup":"Clinton","showlegend":false,"xaxis":"x","yaxis":"y2","hoverinfo":"text","frame":null},{"x":[17111,17091,17068,17021,16965,16882],"y":[44,47,41,44,49,54],"text":["Date: 2016-11-06<br />Poll: 44<br />Candidate: Clinton","Date: 2016-10-17<br />Poll: 47<br />Candidate: Clinton","Date: 2016-09-24<br />Poll: 41<br />Candidate: Clinton","Date: 2016-08-08<br />Poll: 44<br />Candidate: Clinton","Date: 2016-06-13<br />Poll: 49<br />Candidate: Clinton","Date: 2016-03-22<br />Poll: 54<br />Candidate: Clinton"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":1,"size":5.66929133858268,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(248,118,109,1)"}},"hoveron":"points","name":"Clinton","legendgroup":"Clinton","showlegend":false,"xaxis":"x","yaxis":"y3","hoverinfo":"text","frame":null},{"x":[17111,17110,17109,17108,17107,17106,17105,17104,17103,17102,17087,17101,17100,17099,17098,17097,17066,17052,17017,16996,16975,16940,16866,16782],"y":[43,43,43,43,44,45,46,46,45,45,43,45,44,42,40,38,44,41,40,39,39,46,41,44],"text":["Date: 2016-11-06<br />Poll: 43<br />Candidate: Trump","Date: 2016-11-05<br />Poll: 43<br />Candidate: Trump","Date: 2016-11-04<br />Poll: 43<br />Candidate: Trump","Date: 2016-11-03<br />Poll: 43<br />Candidate: Trump","Date: 2016-11-02<br />Poll: 44<br />Candidate: Trump","Date: 2016-11-01<br />Poll: 45<br />Candidate: Trump","Date: 2016-10-31<br />Poll: 46<br />Candidate: Trump","Date: 2016-10-30<br />Poll: 46<br />Candidate: Trump","Date: 2016-10-29<br />Poll: 45<br />Candidate: Trump","Date: 2016-10-28<br />Poll: 45<br />Candidate: Trump","Date: 2016-10-13<br />Poll: 43<br />Candidate: Trump","Date: 2016-10-27<br />Poll: 45<br />Candidate: Trump","Date: 2016-10-26<br />Poll: 44<br />Candidate: Trump","Date: 2016-10-25<br />Poll: 42<br />Candidate: Trump","Date: 2016-10-24<br />Poll: 40<br />Candidate: Trump","Date: 2016-10-23<br />Poll: 38<br />Candidate: Trump","Date: 2016-09-22<br />Poll: 44<br />Candidate: Trump","Date: 2016-09-08<br />Poll: 41<br />Candidate: Trump","Date: 2016-08-04<br />Poll: 40<br />Candidate: Trump","Date: 2016-07-14<br />Poll: 39<br />Candidate: Trump","Date: 2016-06-23<br />Poll: 39<br />Candidate: Trump","Date: 2016-05-19<br />Poll: 46<br />Candidate: Trump","Date: 2016-03-06<br />Poll: 41<br />Candidate: Trump","Date: 2015-12-13<br />Poll: 44<br />Candidate: Trump"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,191,196,1)","opacity":1,"size":5.66929133858268,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(0,191,196,1)"}},"hoveron":"points","name":"Trump","legendgroup":"Trump","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[17111,17090,17069,17041,17020,16998,16971,16880],"y":[44,38,42,39,37,43,37,34],"text":["Date: 2016-11-06<br />Poll: 44<br />Candidate: Trump","Date: 2016-10-16<br />Poll: 38<br />Candidate: Trump","Date: 2016-09-25<br />Poll: 42<br />Candidate: Trump","Date: 2016-08-28<br />Poll: 39<br />Candidate: Trump","Date: 2016-08-07<br />Poll: 37<br />Candidate: Trump","Date: 2016-07-16<br />Poll: 43<br />Candidate: Trump","Date: 2016-06-19<br />Poll: 37<br />Candidate: Trump","Date: 2016-03-20<br />Poll: 34<br />Candidate: Trump"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,191,196,1)","opacity":1,"size":5.66929133858268,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(0,191,196,1)"}},"hoveron":"points","name":"Trump","legendgroup":"Trump","showlegend":false,"xaxis":"x","yaxis":"y2","hoverinfo":"text","frame":null},{"x":[17111,17091,17068,17021,16965,16882],"y":[41,38,43,40,37,36],"text":["Date: 2016-11-06<br />Poll: 41<br />Candidate: Trump","Date: 2016-10-17<br />Poll: 38<br />Candidate: Trump","Date: 2016-09-24<br />Poll: 43<br />Candidate: Trump","Date: 2016-08-08<br />Poll: 40<br />Candidate: Trump","Date: 2016-06-13<br />Poll: 37<br />Candidate: Trump","Date: 2016-03-22<br />Poll: 36<br />Candidate: Trump"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,191,196,1)","opacity":1,"size":5.66929133858268,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(0,191,196,1)"}},"hoveron":"points","name":"Trump","legendgroup":"Trump","showlegend":false,"xaxis":"x","yaxis":"y3","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":52.5296803652968,"r":7.30593607305936,"b":22.648401826484,"l":37.2602739726027},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"title":{"text":"Hillary vs. Trump (2016)","font":{"color":"rgba(0,0,0,1)","family":"","size":17.5342465753425},"x":0.5,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[16765.55,17127.45],"tickmode":"array","ticktext":["dic.-15","ene.-16","feb.-16","mar.-16","abr.-16","may.-16","jun.-16","jul.-16","ago.-16","sep.-16","oct.-16","nov.-16"],"tickvals":[16770,16801,16832,16861,16892,16922,16953,16983,17014,17045,17075,17106],"categoryorder":"array","categoryarray":["dic.-15","ene.-16","feb.-16","mar.-16","abr.-16","may.-16","jun.-16","jul.-16","ago.-16","sep.-16","oct.-16","nov.-16"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-75,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y3","title":"","hoverformat":".2f"},"yaxis":{"domain":[0.695159817351598,1],"automargin":true,"type":"linear","autorange":false,"range":[28.5,61.5],"tickmode":"array","ticktext":["30","40","50","60"],"tickvals":[30,40,50,60],"categoryorder":"array","categoryarray":["30","40","50","60"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":"","hoverformat":".2f"},"annotations":[{"text":"Poll (% of total survey)","x":-0.033972602739726,"y":0.5,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-90,"xanchor":"right","yanchor":"center","annotationType":"axis"},{"text":"ABC News/Washington Post","x":0.5,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.689497716895},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"},{"text":"Monmouth University","x":0.5,"y":0.638173515981735,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.689497716895},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"},{"text":"Selzer & Company","x":0.5,"y":0.304840182648402,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.689497716895},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"},{"text":"Candidate","x":1.02,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"left","yanchor":"bottom","legendTitle":true}],"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0.695159817351598,"y1":1},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"transparent","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":23.37899543379,"yanchor":1,"ysizemode":"pixel"},{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0.361826484018265,"y1":0.638173515981735},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"transparent","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":23.37899543379,"yanchor":0.638173515981735,"ysizemode":"pixel"},{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":0.304840182648402},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"transparent","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":23.37899543379,"yanchor":0.304840182648402,"ysizemode":"pixel"}],"yaxis2":{"type":"linear","autorange":false,"range":[28.5,61.5],"tickmode":"array","ticktext":["30","40","50","60"],"tickvals":[30,40,50,60],"categoryorder":"array","categoryarray":["30","40","50","60"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"domain":[0.361826484018265,0.638173515981735],"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":"","hoverformat":".2f"},"yaxis3":{"type":"linear","autorange":false,"range":[28.5,61.5],"tickmode":"array","ticktext":["30","40","50","60"],"tickvals":[30,40,50,60],"categoryorder":"array","categoryarray":["30","40","50","60"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"domain":[0,0.304840182648402],"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":"","hoverformat":".2f"},"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895},"y":0.937637795275591},"hovermode":"closest","width":500,"height":500,"barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"1d9c707d7791":{"x":{},"y":{},"colour":{},"type":"scatter"},"1d9c6fe13171":{"x":{},"y":{},"colour":{}}},"cur_data":"1d9c707d7791","visdat":{"1d9c707d7791":["function (y) ","x"],"1d9c6fe13171":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p>Let’s move now to Power BI and see what would have happened. I copied the modified dataset as a csv file and uploaded it to Power BI desktop. As can bee seen in the image below, potly does not create a visual itself so it leads to an error in Power BI.</p>
<center>
<img src="/post/images/post_two_powebierror.png" alt="Figure 2. Problems with plotly in Power BI." id="id" class="class" style="width:100.0%;height:100.0%" />
</center>
<p> </p>
<p>In the following section I will explain how to create custom visuals for Power BI using R, which will allow us to use plotly and many other R packages.</p>
</div>
<div id="creating-custom-visualizations" class="section level2">
<h2>Creating custom visualizations</h2>
<p>This is an step by step tutorial in Windows. It looks like a large and complicated procedure, but after your first time you will notice that it is not that hard. I will show screenshots of each step so you can replicate them in your computer easily.</p>
<div id="setting-up-your-computer" class="section level3">
<h3>Setting up your computer</h3>
<p><strong>1.</strong> Verify that you have installed the required packages. In case you do not, install them.</p>
<pre class="r"><code>c(&quot;tidyverse&quot;, 
  &quot;XML&quot;, 
  &quot;htmlwidgets&quot;
) %in% installed.packages()
## [1] TRUE TRUE TRUE</code></pre>
<p><strong>2.</strong> Install node js. You can find it <a href="https://nodejs.org/es/">here</a>.</p>
<p><strong>3.</strong> Go to Power Shell and install Power BI visual tools.</p>
<center>
<img src="/post/images/post_two_powershell.png" alt="Figure 3. Installing Power BI visuals tools." id="id" class="class" style="width:100.0%;height:100.0%" />
</center>
<p> </p>
<p>Once is installed you can keep working in Power Shell but I recommend to move to CMD. I have had problems in Power Shell that I did not at CMD, although I don’t really know why. Also, you can check that the installation was succesfull if you get this result when you call Power BI visuals tools.</p>
<center>
<img src="/post/images/post_two_checking.png" alt="Figure 4. Check that the installation ran succesfully." id="id" class="class" style="width:100.0%;height:100.0%" />
</center>
<p> </p>
<p>This is all what you need to set up your computer, now you are ready to create your own visualizations.</p>
</div>
<div id="organize-your-package" class="section level3">
<h3>Organize your package</h3>
<p><strong>4.</strong> Create a directory where you want to save your visuals and go to that folder with the command prompt (use <em>cd</em> to move from one folder to another one and <em>mkdir</em> to create a new one). In my case I called it PBIVisualizations.</p>
<p><strong>5.</strong> Create a template for the visualization.</p>
<center>
<img src="/post/images/post_two_template.png" alt="Figure 5. Create a template visualization." id="id" class="class" style="width:100.0%;height:100.0%" />
</center>
<p> </p>
<p><strong>6.</strong> Here we have to make some modifications in the package since it comes with some bugs. For this step you can use your IDE of preference but I strongly recommend Visual Studio.
 </p>
<ul>
<li>Go to <em>pbiviz.json</em> and add at least a name, email, description and supportUrl. I also recommend to change the guid field so your visualization does not carry a name too long and meaningless.</li>
</ul>
<center>
<img src="/post/images/post_two_visualts.png" alt="Figure 6. Fix visual.ts file bug." id="id" class="class" style="width:100.0%;height:100.0%" />
</center>
<p> 
 
 </p>
<ul>
<li><p>Go to <em>dependencies.json</em> and add any other library you are using with the same format it has for the other libraries.</p></li>
<li><p>In the folder <em>src</em>, there is a file called <em>visual.ts</em>. Open it and replace ‘NodeListOf’ with ‘HTMLCollectionOf’.</p></li>
<li><p>You can also go to the <em>assets</em> folder and change the icon for another image. This is the one that appears in the right panel at Power BI with all of the others visualizations.</p></li>
</ul>
<p><strong>7.</strong> Now the most interesting part of the tutorial: creating the visualization with our R code. Open the file <em>script.R</em> and paste the code we made in the “Actual code” section. Personally, I like to delete all of the semicolons and change the = for &lt;-, but that’s your call. There is one important trick you have to remember:
 </p>
<ul>
<li>In Power BI, the datasets that are dragged to our custom visualization are called Values in the file <em>scrip.R</em>, so you must adapt your code to get data from a data frame called Values.</li>
</ul>
<center>
<img src="/post/images/post_two_script.png" alt="Figure 7. Where to paste R code." id="id" class="class" style="width:100.0%;height:100.0%" />
</center>
<p> </p>
<p><strong>8.</strong> Go back to CMD. move to the folder that has the visualization package and run the function to create the <em>.pbiviz file</em>.</p>
<center>
<img src="/post/images/post_two_package.png" alt="Figure 8. Create custom visual." id="id" class="class" style="width:100.0%;height:100.0%" />
</center>
<p> </p>
<p><strong>9.</strong> Import your custom visualization to Power BI. The file will be located in your package directory, in a folder called <em>dist</em>.</p>
<center>
<img src="/post/images/post_two_import.png" alt="Figure 8. Import custom visual." id="id" class="class" style="width:100.0%;height:100.0%" />
</center>
<p> </p>
<p><strong>10.</strong> You can publish your visualizations using your business account of Power BI, but you may need to verify <a href="https://docs.microsoft.com/en-us/power-bi/service-r-packages-support/">here</a> that the R libraries you are using are available.</p>
</div>
</div>
